<!DOCTYPE html>
<html>
  <script src="index.js"></script>
  <script>
    // 8 workers spaced at 20ms seems to work well
    const workers = PS["FRP.Behavior.Audio.Example.Readme"].makeWorkers(8)();

    var offCb = null;
    var audioCtx = null;
    function turnOnAudio() {
      const myAudio = new Audio(
        "https://www.zapsplat.com/wp-content/uploads/2015/sound-effects-55112/zapsplat_nature_rainforest_ambience_wind_trees_birds_mainly_cockatoos_close_by_early_spring_qld_australia_55319.mp3"
      );
      navigator.mediaDevices.getUserMedia({ audio: true }).then(function (mic) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        audioCtx.audioWorklet.addModule("ps-aud-mul.js").then(function () {
          var now = new Date().getTime();
          var ctr = 0;
          // null for the microphone
          offCb = PS["FRP.Behavior.Audio.Example.Readme"].run(15)(10)(audioCtx)(
            mic
          )({
            forest: myAudio,
          })(workers)(function (timeToSet) {
            return function (instructions) {
              return function (ctx) {
                return function (stream) {
                  return function (sources) {
                    return function (units) {
                      return function () {
                        return PS[
                          "FRP.Behavior.Audio.Example.Readme"
                        ].touchAudio(timeToSet)(instructions)(ctx)(stream)(
                          sources
                        )(units)();
                      };
                    };
                  };
                };
              };
            };
          })();
        });
      });
    }
    function turnOffAudio() {
      offCb ? offCb() : null;
      offCB = null;
      audioCtx ? audioCtx.close() : null;
      audioCtx = null;
    }
  </script>
  <body>
    <button onclick="turnOnAudio();">turn on</button>
    <button onclick="turnOffAudio();">turn off</button>
  </body>
</html>
